onyxia:
  friendlyName: superset
  owner: custom
  share: true
  userDefinedValues: ""

ingress:
  enabled: true
  ingressClassName: nginx
  hosts:
    - custom-host.lab.incubateur.finances.rie.gouv.fr

image:
  repository: ghcr.io/etalab-ia/chartsgouv
  tag: 4.1.2-1.13.1-2.0.3
  pullPolicy: IfNotPresent

extraVolumes:
  - name: superset-tmp-custom-extra-config
    configMap:
      name: superset-tmp-custom-extra-config
#  - name: client-secret
#    secret:
#      secretName: client-secret

extraVolumeMounts:
  - name: superset-tmp-custom-extra-config
    mountPath: /app/pythonpath/custom_config
#  - name: client-secret
#    mountPath: /app/client_secret.json
#    subPath: client_secret.json
#    readOnly: true

# NÃ©cessaire d'installer les packages des connectors manuellement depuis la 4.1
bootstrapScript: |
  #!/bin/bash
  # Update system packages and install dependencies
  apt update

  CONFIG_PIP=true

  # Check if CONFIG_PIP is enabled
  if [ "$CONFIG_PIP" = true ]; then
    echo "Configuring Pip..."
    # Define the custom PyPI index URL and trusted host
    PIP_INDEX_URL="https://bercyhub:bercyhub@nexus.pic.dgfip.finances.rie.gouv.fr/repository/pypi/simple/"
    PIP_TRUSTED_HOST="nexus.pic.dgfip.finances.rie.gouv.fr"

    # Ensure the .pip directory exists
    mkdir -p ~/.pip

    # Create or update the pip configuration file
    cat > ~/.pip/pip.conf <<EOL
  [global]
  index-url = $PIP_INDEX_URL
  trusted-host = $PIP_TRUSTED_HOST
  EOL

    echo "Pip configuration updated successfully!"
  else
      echo "Skipping Pip configuration."
  fi
  
  # Install Python dependencies
  pip install psycopg2-binary==2.9.10
  pip install openpyxl==3.1.5
  pip install duckdb==1.2.0

  # Create a bootstrap log file if not already created
  if [ ! -f ~/bootstrap ]; then 
    echo "Running Superset with uid {{ .Values.runAsUser }}" > ~/bootstrap
  fi

init:
  adminUser:
    # Override
    username: admin
    password: admin
extraSecretEnv:
  MAPBOX_API_KEY: 'Your token'
  SUPERSET_SECRET_KEY: 'Your secret key'
supersetNode:
  replicas:
    enabled: true
    replicaCount: 1
  autoscaling:
    enabled: false
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 80
    # targetMemoryUtilizationPercentage: 80
  connections:
    # You need to change below configuration incase bringing own PostgresSQL instance and also set postgresql.enabled:false
    db_host: "{{ .Release.Name }}-postgresql"
    db_port: "5432"
    db_user: superset
    db_pass: superset
    db_name: superset
## Set to false if bringing your own PostgreSQL.
postgresql:
  enabled: false
# Superset Celery worker configuration
supersetWorker:
  replicas:
    enabled: true
    replicaCount: 1
  autoscaling:
    enabled: false
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 80
    # targetMemoryUtilizationPercentage: 80
  # -- Sets the [pod disruption budget](https://kubernetes.io/docs/tasks/run-application/configure-pdb/) for supersetWorker pods
